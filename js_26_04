<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Konfiguracja/Config Page</title>

<style type="text/css">
body
{
    background-color: #000000;
    color: gray;
    font-size: 12px;
    font-weight: 700;
}

input
{
width: 17%;
background-color: #dcddd9;
color: green;

border-radius: 10px;
margin-top: 10px;
margin-bottom: 10px;
margin-left: 3px;
font-size: 11px;
padding: 5px;
text-align: center;
text-transform: uppercase;
}
input[type="radio"]
{
outline: none;
}

input:disabled
{
color: darkgoldenrod;
}

input:focus ,input:hover
{
background-color: lightyellow;
color: red;
font-weight: bolder;
}

form
{}

button
{
width: 40%;
background-color: darkgreen;
font-size: 14px;
color: white;
padding: 15px 10px;
margin-top: 10px;
border-radius: 10px;
cursor: pointer;
}

button:hover
{
background-color: #36b03c;
}

.kafel
{
    width: 320px;
    height: 800px;
    text-align: center;
    padding: 5px;
    margin: 5px;
    border: 3px solid green;
    float: left;
    cursor: pointer;
    border-radius: 15px;
}
.kafel fieldset
{
border-radius: 15px;
border: 3px solid green;
margin-bottom: 5px;
}

.kafel:hover , .kafel fieldset:hover
{
    background-color: #222222;
    color: white;
    border: 3px solid lightgreen;
}

.kafel p
{

color: lightgreen;
font-size: 14px;
font-weight: 700;
}

.kafel span
{
font-size: 12px;
color: yellow;
}


#glowny
{
    width: 501px;
    margin-left:auto;
    margin-right:auto;
}

</style>
<script type="text/javascript">
//document.write("hello");
var serial="1234567890abcd";
var model="Prototyp_XX-XX";
var ZapisNr=1;
var dmxUniverse=0;
var MAB=8;
var Break=88;
var dhcp=1;
var firmware_v="firmware_v1";
var ip_add=[192,168,0,222];
var maska=[255,255,255,0];
var gw=[192,168,0,1];
var MAC=[0x00, 0x08, 0xdc, 0x01, 0x02, 0x1A];
var mak_5=" ";
//var p_ip="(?<!\d)(?:[1-9]?\d|1\d\d|2(?:[0-4]\d|5[0-5]))(?!\d)";


//function hexRep(number, width) { return (number+Math.pow(16, precision)).toString(16).slice(-width); }
//function Deaktif() {for (var n=0;n<v.length-3;n++) {v[n].setAttribute("disabled",true) ;}

function start()
{
//window.location.reload(false);// jakies gówno
document.getElementById("numer_ser").innerHTML=serial; //info_text;//+info_inputy;//+info_inputy2+info_inputy3+info_inputy4;
document.getElementById("model_info").innerHTML=model;
document.getElementById("firmware").innerHTML=firmware_v;
document.getElementById("zapis_nr").innerHTML=ZapisNr;
  v=document.querySelectorAll('input[type=number]');
  r=document.getElementsByName("_dhcp"); //console.log('radioL='+radio.length);
 
  rad=document.getElementById("_dhcp") ;  
 kt=document.getElementById("_statyk") ;
 mak_test=document.getElementById("m5");
 for (let a=0;a<v.length;a++){

 v[a].addEventListener('blur',function(){ 
//let rg=new  RegExp("(?<!\d)(?:[1-9]?\d|1\d\d|2(?:[0-4]\d|5[0-5]))(?!\d)" , "g");
let g=parseInt(this.value,10);
limL=0 ; limH=255;
switch(a) {
case 0: limL=2; limH=254; break;
case 3: limL=2; limH=250; break;
case	4: limL=255; break;
case 7: limH=0;break;
case 11: limL=1 ;break;
case 13: limL=8; limH=16; break;
case 14: limL=88; limH=170; break;
}
if (!(g>=limL && g<=limH))
{
this.value=limL;
alert("liczba z zakresu / Range number : "+ limL + "-" + limH );

}
  
 console.log("X0");} )
 }
if (dhcp) 
{rad.setAttribute("checked","true");
Deaktif();
}
else {kt.setAttribute("checked","false");
Aktif();
 }

rad.addEventListener('click', Deaktif);
kt.addEventListener('click', Aktif);
mak_test.addEventListener('change', Sprawdz);
for (i=0;i<5;i++)
{ mak_5+=MAC[i].toString(16)+':' ;}

document.getElementById("m5").value=MAC[5].toString(16).toUpperCase();
document.getElementById("mak").innerHTML=mak_5.toUpperCase();
//v=document.querySelectorAll('input[type=number]');



 document.querySelector('#formAjax').addEventListener('submit', function(e) 
 { 
 console.log("ajax_form _przed")
  e.preventDefault(); //przerywamy domyślną akcję formularza
 console.log("po_prevencie")
  let xhr = new XMLHttpRequest();
		 const sp='&';
		
		let f=checkRadio();
    console.log(f);//console.log(surnameVal)
     let formData ='dhcp='+f ;//+sp+out[0];
    //let surnameVal = document.querySelector('#ip1').value;
     let out=[];
     for (let i=0;i < v.length; i++)
     {
     out[i]=v[i].value;console.log(out[i]);
     formData+=sp+out[i];
     }
     console.log(formData);
    //let wybor=testRadio();
    

    //typ połączenia, url, czy asynchroniczen
    xhr.open("POST", "/this", true);

    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

    xhr.addEventListener('load', function() {
        if (this.status === 200) {
            console.log(this.responseText);
        }
    })
    

    xhr.send(formData);
    
 })



//document.querySelector('fieldset').
for(x=0;x<4;x++)
  {
    v[x].setAttribute("value",ip_add[x]);
        v[x+4].setAttribute("value",maska[x]);
             v[x+8].setAttribute("value",gw[x]);
  }
  v[12].setAttribute("value",dmxUniverse);
   v[13].setAttribute("value",MAB);
    v[14].setAttribute("value",Break);
}
window.onload=start;

function Deaktif() {for (var n=0;n<v.length-3;n++) {v[n].setAttribute("disabled",true) ;}}
function Aktif()  {for (var n=0;n<v.length-3;n++) {v[n].removeAttribute("disabled"); }}
function Sprawdz() {const reg=new RegExp("[a-f0-9]{2}","i");if (!reg.test(this.value)) { alert("To nie jest liczba hex ");this.value="F0";}	 }
function checkRadio() {const gr =document.querySelectorAll('input[name="_dhcp"]');  for (let i=0; i<gr.length; i++) {if (gr[i].checked) {  return i;break; } }}	

</script>
</head>
<body>

 <div id="glowny">
<div id="info" class="kafel">
<p><u>Informacja / Device info</u>  </p>
<label  >Model :</label>  <span class="zolty" id="model_info"> </span> <br>
<label  >S/N :</label>  <span class="zolty" id="numer_ser"> </span><br>
<label  > Firmware :</label>  <span class="zolty" id="firmware"> </span><br>
<label  > Flash save #:</label>  <span class="zolty" id="zapis_nr"> </span><br>

<form id="formAjax"  method="POST"  >

<p><u>Konfiguracja sieci / Net Configuration </u><br> </p>
<fieldset id="fild">
<input type="radio" id="_dhcp" name="_dhcp">DHCP
 <input type="radio" name="_dhcp" id="_statyk">STATIC IP ADDRESS
</fieldset>
<label for="ip0">Adres_ IP / IP Address:<br> <input   id="ip0" min="2" max="255" type="number"  >    </label>
<label>.<input   id="ip1" min="0" max="255" type="number"  >    </label>
<label>.<input   id="ip2" min="0" max="255" type="number"  >    </label>
<label>.<input   id="ip3" min="1" max="252" type="number"  >    </label>
<label for="m0">Maska IP / IP Mask: <br> <input  id="m0" min="255" max="255"  type="number">   </label>
<label>.<input   id="m1" min="0" max="255" type="number"  >    </label>
<label>.<input   id="m2" min="0" max="255" type="number"  >    </label>
<label>.<input   id="m3" min="0" max="255" type="number"  >    </label>
<label for="g0">Brama domyślna / Default GateWay: <br><input  min="2" max="255" id="g0"  type="number"  >    </label>
<label>.<input   id="g1" name="g1" min="0" max="255" type="number" >    </label>
<label>.<input   id="g2" min="0" max="255" type="number"  >   </label>
<label>.<input   id="g3" min="1" max="254" type="number"  >    </label>
<label>MAC adres: <span class="zolty" id="mak"> MAC</span> </label>

 <input   id="m5"  type="text"  maxlength="2" autocomplete="false" placeholder="FF">

<p><u>Konfiguracja/ Config DMX512 & Art-Net </u><br> </p>

<label>Art-Net Universe (0-255) # :<br>
 <input id="_dmxUniverse" type="number" min="0" max="255">  </label> <br>
<label>DMX512 parametr MAB (8-16uS) :<br>
<input id="_MAB" type="number" min="8" max="16"> </label> <br>
<label>DMX512 parametr BREAK (88-170uS) :<br> <input id="_Break" type="number" min="88" max="170"> </label> <br>

  <button id="zapisz" type="submit" value="Submit">Zapisz / Save</button>
 <button >Reset</button>
</div>
</form>
</div>

</body>
</html>

